% --- SCRIPT: VISUALIZAÇÃO DA NUVEM DE DADOS (LDA) ---
clear;
clc;
close all;
fprintf("Iniciando Visualização da Nuvem de Features (LDA)...\n");

%% --- PASSO 1: Carregar as Features salvas ---
try
    load('features_AR30_REAL.mat'); % Carrega 'all_features' e 'all_labels'
    fprintf("Arquivo 'features_AR30_REAL.mat' carregado.\n");
catch
    fprintf("ERRO: Não achei o arquivo 'features_AR30_REAL.mat'.\n");
    return;
end

%% --- PASSO 2: Criar Grupos (Saudável vs. Dano) ---
% Precisamos rotular cada uma das 120 amostras
healthyStates = [1, 2, 8, 9];
groups = cell(length(all_labels), 1); % Cria uma célula vazia

for i = 1:length(all_labels)
    if ismember(all_labels(i), healthyStates)
        groups{i} = 'Saudável';
    else
        groups{i} = 'Danificado';
    end
end
fprintf("Rótulos de 'Saudável' e 'Danificado' criados.\n");

%% --- PASSO 3: Aplicar LDA (A "Mágica" Supervisionada) ---
% A função 'fitcdiscr' treina o modelo LDA.
% Ela usa as features (all_features) e os rótulos (groups)
% para encontrar a melhor projeção que SEPARA os grupos.

fprintf("Calculando LDA para encontrar o eixo de separação...\n");
Mdl = fitcdiscr(all_features, groups);

% Agora, vamos projetar todas as 30 features de cada amostra
% nesta ÚNICA "super-feature" (LD1) que o LDA encontrou.
% K é a constante (intercept) e L são os coeficientes (pesos) 30x1
K = Mdl.Coeffs(1,2).Const;
L = Mdl.Coeffs(1,2).Linear;

% LD1_scores é o seu novo "eixo X" (120x1)
LD1_scores = all_features * L + K;

% Separar os scores dos dois grupos
healthy_scores = LD1_scores(strcmp(groups, 'Saudável'));
damaged_scores = LD1_scores(strcmp(groups, 'Danificado'));

%% --- PASSO 4: Plotar os Histogramas Sobrepostos ---
fprintf("Gerando gráfico de histogramas...\n");

figure;
hold on;

% Plotar o histograma dos dados DANIFICADOS
histogram(damaged_scores, 'Normalization', 'pdf', ...
          'FaceColor', [0.8500 0.3250 0.0980], 'FaceAlpha', 0.6); % Cor Laranja/Vermelha

% Plotar o histograma dos dados SAUDÁVEIS
histogram(healthy_scores, 'Normalization', 'pdf', ...
          'FaceColor', [0 0.4470 0.7410], 'FaceAlpha', 0.6); % Cor Azul

title('Visualização da Separação de Nuvem (LDA)');
xlabel('Eixo Discriminante Linear 1 (LD1)');
ylabel('Densidade de Probabilidade (PDF)');
legend('Danificado', 'Saudável');
grid on;
hold off;

fprintf('Processo concluído!\n');
